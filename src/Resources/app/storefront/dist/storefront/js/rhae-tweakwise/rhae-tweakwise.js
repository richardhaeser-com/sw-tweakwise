(()=>{"use strict";class t{static iterate(t,e){if(t instanceof Map||Array.isArray(t))return t.forEach(e);if(t instanceof FormData){for(var i of t.entries())e(i[1],i[0]);return}if(t instanceof NodeList)return t.forEach(e);if(t instanceof HTMLCollection)return Array.from(t).forEach(e);if(t instanceof Object)return Object.keys(t).forEach(i=>{e(t[i],i)});throw Error(`The element type ${typeof t} is not iterable!`)}}class e{static serialize(t){let e=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if("FORM"!==t.nodeName){if(e)throw Error("The passed element is not a form!");return{}}return new FormData(t)}static serializeJson(t){let i=!(arguments.length>1)||void 0===arguments[1]||arguments[1],a=e.serialize(t,i);if(!(a instanceof FormData)&&0===Object.keys(a).length||a instanceof FormData&&0===Array.from(a.entries()).length)return{};let r={};for(let[t,e]of a.entries())r[t]=e;return r}}let i=window.PluginBaseClass;window.PluginManager;class a extends i{init(){this._registerEvents()}_registerEvents(){let t=this._addToCart.bind(this);window.addEventListener("twAddToCart",t)}_extractShopwareUUID(t){let e=t.match(/-([a-f0-9]{32})$/i);return e?e[1]:null}_addToCart(t){let i=this._extractShopwareUUID(t.detail.data.itemno);if(!i){console.log("Not a valid product id given",t.detail.itemno);return}let a=document.createElement("form");a.dataset.addToCart="true",a.setAttribute("action",t.detail.addToCartAction),a.setAttribute("method","post"),a.setAttribute("id","twn-add-to-cart-form"),a.setAttribute("data-add-to-cart","true");let r=document.createElement("input");r.setAttribute("type","hidden"),r.setAttribute("name","redirectTo"),r.setAttribute("value","frontend.cart.offcanvas");let s=document.createElement("input");s.setAttribute("type","hidden"),s.setAttribute("name","redirectParameters"),s.dataset.redirectParameters="true",s.setAttribute("value",'{"productId": "'+i+'"}');let n=document.createElement("input");n.setAttribute("type","hidden"),n.setAttribute("name","lineItems["+i+"][id]"),n.setAttribute("value",i);let d=document.createElement("input");d.setAttribute("type","hidden"),d.setAttribute("name","lineItems["+i+"][referencedId]"),d.setAttribute("value",i);let o=document.createElement("input");o.setAttribute("type","hidden"),o.setAttribute("name","lineItems["+i+"][type]"),o.setAttribute("value","product");let l=document.createElement("input");l.setAttribute("type","hidden"),l.setAttribute("name","lineItems["+i+"][stackable]"),l.setAttribute("value","1");let u=document.createElement("input");u.setAttribute("type","hidden"),u.setAttribute("name","lineItems["+i+"][removable]"),u.setAttribute("value","1");let c=document.createElement("input");c.setAttribute("type","hidden"),c.setAttribute("name","lineItems["+i+"][quantity]"),c.setAttribute("value","1");let h=document.createElement("input");h.setAttribute("type","hidden"),h.setAttribute("name","_csrf_token"),h.setAttribute("value",t.detail.csrfToken),a.appendChild(r),a.appendChild(s),a.appendChild(n),a.appendChild(d),a.appendChild(o),a.appendChild(l),a.appendChild(u),a.appendChild(c),a.appendChild(h);let m=t.detail.addToCartAction,p=e.serialize(a);this.$emitter.publish("beforeFormSubmit",p),this._openOffCanvasCarts(m,p)}_openOffCanvasCarts(e,i){let a=window.PluginManager.getPluginInstances("OffCanvasCart");t.iterate(a,t=>this._openOffCanvasCart(t,e,i))}_openOffCanvasCart(t,e,i){t.openOffCanvas(e,i,()=>{this.$emitter.publish("openOffCanvasCart")})}}let r=window.PluginBaseClass;class s extends r{init(){"WishlistStorage"in window.PluginManager.getPluginList()&&(this.classList={isLoading:"product-wishlist-loading",addedState:"product-wishlist-added",notAddedState:"product-wishlist-not-added"},this._getWishlistStorage(),this._wishlistStorage||console.warn("No wishlist storage found"),this._registerEvents())}_registerEvents(){let t=this._navigationSuccess.bind(this),e=this._addToFavorites.bind(this);document.$emitter.subscribe("Wishlist/onProductsLoaded",()=>{wishlistProductsLoaded=!0}),window.addEventListener("twAddToFavorites",e),window.addEventListener("twInitFavorites",t)}_navigationSuccess(t){if(t.detail.data.hasOwnProperty("items"))for(var e of t.detail.data.items)this._checkProductFavorite(e);if(t.detail.data.hasOwnProperty("groups"))for(var i of t.detail.data.groups)for(var e of i.items)this._checkProductFavorite(e)}_checkProductFavorite(t){let e=this._extractShopwareUUID(t.itemno);if(!e){console.log("Not a valid product id given",t.itemno);return}this._wishlistStorage.has(e)&&document.querySelectorAll(`[data-item-id="${t.itemno}"]`).forEach(t=>{t.classList.add("in-wishlist")})}_extractShopwareUUID(t){let e=t.match(/-([a-f0-9]{32})$/i);return e?e[1]:null}_addToFavorites(t){let e=this._extractShopwareUUID(t.detail.data.itemno);if(!e){console.log("Not a valid product id given",t.event.detail.itemno);return}let i={path:t.detail.routerAddPath.replace("idPlaceholder",e),afterLoginPath:t.detail.routerAddAfterLoginPath.replace("idPlaceholder",e)},a={path:t.detail.routerRemovePath.replace("idPlaceholder",e)};var r=document.querySelectorAll(`[data-item-id="${t.detail.data.itemno}"]`);this._wishlistStorage.has(e)?(this._wishlistStorage.remove(e,a),r.forEach(t=>{t.classList.remove("in-wishlist")})):(this._wishlistStorage.add(e,i),r.forEach(t=>{t.classList.add("in-wishlist")}))}_getWishlistStorage(){let t=document.querySelector("#wishlist-basket");t&&(this._wishlistStorage=window.PluginManager.getPluginInstanceFromElement(t,"WishlistStorage"),this._wishlistStorage.load())}}let n=window.PluginManager,d=n.getPluginList();try{(!1 in d||!n.getPlugin("TwAddToCartPlugin"))&&n.register("TwAddToCartPlugin",a)}catch(t){n.register("TwAddToCartPlugin",a)}try{(!1 in d||!n.getPlugin("TwAddToFavoritesPlugin"))&&n.register("TwAddToFavoritesPlugin",s)}catch(t){n.register("TwAddToFavoritesPlugin",s)}})();