(()=>{var e={579:()=>{(async()=>{let e=window.tweakwiseConfig?.instanceKey;if(!e||window.__tweakwiseEventTagLoaded||(window.__tweakwiseEventTagLoaded=!0,!window.tweakwise||"function"!=typeof window.tweakwise.getProfileKey))return;let t=await window.tweakwise.getProfileKey();!function(e,t,i,r,a,n){e._twa=i,e[i]=e[i]||[],e[i].push({"twa.start":new Date().getTime(),event:"twa.js"}),e[i].push({"twa.instance":r,event:"twa.init"}),a&&e[i].push({"twa.profile":a,event:"twa.profile"}),a&&(e[i].getProfileKey=function(){return a});var o=t.getElementsByTagName("script")[0],s=t.createElement("script");s.async=!0,s.src=n,o.parentNode.insertBefore(s,o)}(window,document,"tweakwiseLayer",e,t,"//navigator-analytics.tweakwise.com/bundles/scout.js")})()},845:()=>{(()=>{let e=window.tweakwise=window.tweakwise||{};e.getProfileKey=function(){return e.profileKey?Promise.resolve(e.profileKey):(e.profileKeyPromise||(e.profileKeyPromise=fetch("/tweakwise/profile-key",{credentials:"same-origin",headers:{Accept:"application/json"}}).then(e=>{if(!e.ok)throw Error(`Failed to load profile key (${e.status})`);return e.json()}).then(t=>(e.profileKey=t.profileKey,e.profileKey))),e.profileKeyPromise)}})()}},t={};function i(r){var a=t[r];if(void 0!==a)return a.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,i),n.exports}(()=>{"use strict";i(845),i(579);class e{static iterate(e,t){if(e instanceof Map||Array.isArray(e))return e.forEach(t);if(e instanceof FormData){for(var i of e.entries())t(i[1],i[0]);return}if(e instanceof NodeList)return e.forEach(t);if(e instanceof HTMLCollection)return Array.from(e).forEach(t);if(e instanceof Object)return Object.keys(e).forEach(i=>{t(e[i],i)});throw Error(`The element type ${typeof e} is not iterable!`)}}class t{static serialize(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if("FORM"!==e.nodeName){if(t)throw Error("The passed element is not a form!");return{}}return new FormData(e)}static serializeJson(e){let i=!(arguments.length>1)||void 0===arguments[1]||arguments[1],r=t.serialize(e,i);if(!(r instanceof FormData)&&0===Object.keys(r).length||r instanceof FormData&&0===Array.from(r.entries()).length)return{};let a={};for(let[e,t]of r.entries())a[e]=t;return a}}let r=window.PluginBaseClass;window.PluginManager;class a extends r{init(){this._registerEvents()}_registerEvents(){let e=this._addToCart.bind(this);window.addEventListener("twAddToCart",e),document.addEventListener("submit",e=>{let t=e.target.closest('form[data-add-to-cart="true"]');if(!t)return;let i=this._extractAddToCartData(t);i&&this._fireEventTag(i)},!0)}_extractShopwareUUID(e){let t=e.match(/-([a-f0-9]{32})$/i);return t?t[1]:null}_addToCart(e){let i=this._extractShopwareUUID(e.detail.data.itemno);if(!i){console.log("Not a valid product id given",e.detail.itemno);return}let r=document.createElement("form");r.dataset.addToCart="true",r.setAttribute("action",e.detail.addToCartAction),r.setAttribute("method","post"),r.setAttribute("id","twn-add-to-cart-form"),r.setAttribute("data-add-to-cart","true");let a=document.createElement("input");a.setAttribute("type","hidden"),a.setAttribute("name","redirectTo"),a.setAttribute("value","frontend.cart.offcanvas");let n=document.createElement("input");n.setAttribute("type","hidden"),n.setAttribute("name","redirectParameters"),n.dataset.redirectParameters="true",n.setAttribute("value",'{"productId": "'+i+'"}');let o=document.createElement("input");o.setAttribute("type","hidden"),o.setAttribute("name","lineItems["+i+"][id]"),o.setAttribute("value",i);let s=document.createElement("input");s.setAttribute("type","hidden"),s.setAttribute("name","lineItems["+i+"][referencedId]"),s.setAttribute("value",i);let d=document.createElement("input");d.setAttribute("type","hidden"),d.setAttribute("name","lineItems["+i+"][type]"),d.setAttribute("value","product");let l=document.createElement("input");l.setAttribute("type","hidden"),l.setAttribute("name","lineItems["+i+"][stackable]"),l.setAttribute("value","1");let u=document.createElement("input");u.setAttribute("type","hidden"),u.setAttribute("name","lineItems["+i+"][removable]"),u.setAttribute("value","1");let c=document.createElement("input");c.setAttribute("type","hidden"),c.setAttribute("name","lineItems["+i+"][quantity]"),c.setAttribute("value","1");let w=document.createElement("input");w.setAttribute("type","hidden"),w.setAttribute("name","_csrf_token"),w.setAttribute("value",e.detail.csrfToken),r.appendChild(a),r.appendChild(n),r.appendChild(o),r.appendChild(s),r.appendChild(d),r.appendChild(l),r.appendChild(u),r.appendChild(c),r.appendChild(w);let p=e.detail.addToCartAction,h=t.serialize(r);this.$emitter.publish("beforeFormSubmit",h),this._openOffCanvasCarts(p,h)}_openOffCanvasCarts(t,i){let r=window.PluginManager.getPluginInstances("OffCanvasCart");e.iterate(r,e=>this._openOffCanvasCart(e,t,i))}_openOffCanvasCart(e,t,i){e.openOffCanvas(t,i,()=>{this.$emitter.publish("openOffCanvasCart")})}_fireEventTag(e){let{quantity:t,unitPrice:i,total:r,tweakwiseProductId:a}=e;tweakwiseLayer.push({event:"addtocart",data:{productKey:a,quantity:t,totalAmount:r}})}_extractAddToCartData(e){if("undefined"==typeof tweakwiseProductId||!tweakwiseProductId){let t=e.querySelector('input[name="tweakwiseProductId"]');if(!t)return;tweakwiseProductId=t.value}let t=e.querySelector('input[name^="lineItems["][name$="[quantity]"]'),i=1;t&&(Number.isNaN(i=parseInt(t.value||"1",10))||i<1)&&(i=1);let r=this._getUnitPriceFromDom();if(!r){let t=e.querySelector('input[name="tweakwiseProductPrice"]');r=t?t.value:0}let a=null!==r?this._roundMoney(r*i):0;return{quantity:i,unitPrice:r,total:a,tweakwiseProductId}}_getUnitPriceFromDom(){let e=document.querySelector(".product-detail-price")||document.querySelector("[data-product-price]")||document.querySelector('meta[property="product:price:amount"]');if(!e)return null;let t=e.getAttribute("data-product-price");if(t&&!Number.isNaN(parseFloat(t)))return parseFloat(t);let i=e.getAttribute("content");if(i&&!Number.isNaN(parseFloat(i)))return parseFloat(i);let r=parseFloat((e.textContent||"").trim().replace(/\s/g,"").replace(/[^\d,.-]/g,"").replace(/\.(?=\d{3}(\D|$))/g,"").replace(",","."));return Number.isFinite(r)?r:null}_roundMoney(e){return Math.round((e+Number.EPSILON)*100)/100}}let n=window.PluginBaseClass;class o extends n{init(){"WishlistStorage"in window.PluginManager.getPluginList()&&(this.classList={isLoading:"product-wishlist-loading",addedState:"product-wishlist-added",notAddedState:"product-wishlist-not-added"},this._getWishlistStorage(),this._wishlistStorage||console.warn("No wishlist storage found"),this._registerEvents())}_registerEvents(){let e=this._navigationSuccess.bind(this),t=this._addToFavorites.bind(this),i=this._fireEventTag.bind(this);document.$emitter.subscribe("Wishlist/onProductsLoaded",()=>{wishlistProductsLoaded=!0}),window.addEventListener("twAddToFavorites",t),window.addEventListener("twInitFavorites",e),document.querySelector("button[data-add-to-wishlist]")?.addEventListener("click",i)}_navigationSuccess(e){if(e.detail.data.hasOwnProperty("items"))for(var t of e.detail.data.items)this._checkProductFavorite(t);if(e.detail.data.hasOwnProperty("groups"))for(var i of e.detail.data.groups)for(var t of i.items)this._checkProductFavorite(t)}_checkProductFavorite(e){let t=this._extractShopwareUUID(e.itemno);if(!t){console.log("Not a valid product id given",e.itemno);return}this._wishlistStorage.has(t)&&document.querySelectorAll(`[data-item-id="${e.itemno}"]`).forEach(e=>{e.classList.add("in-wishlist")})}_extractShopwareUUID(e){let t=e.match(/-([a-f0-9]{32})$/i);return t?t[1]:null}_addToFavorites(e){let t=this._extractShopwareUUID(e.detail.data.itemno);if(!t){console.log("Not a valid product id given",e.event.detail.itemno);return}let i={path:e.detail.routerAddPath.replace("idPlaceholder",t),afterLoginPath:e.detail.routerAddAfterLoginPath.replace("idPlaceholder",t)},r={path:e.detail.routerRemovePath.replace("idPlaceholder",t)};var a=document.querySelectorAll(`[data-item-id="${e.detail.data.itemno}"]`);this._wishlistStorage.has(t)?(this._wishlistStorage.remove(t,r),a.forEach(e=>{e.classList.remove("in-wishlist")})):(this._wishlistStorage.add(t,i),a.forEach(e=>{e.classList.add("in-wishlist")}))}_getWishlistStorage(){let e=document.querySelector("#wishlist-basket");e&&(this._wishlistStorage=window.PluginManager.getPluginInstanceFromElement(e,"WishlistStorage"),this._wishlistStorage.load())}_fireEventTag(e){if("undefined"==typeof tweakwiseProductId||!tweakwiseProductId){let t=e.target.closest('[role="listitem"]').querySelector('form[data-add-to-cart="true"]');if(!t)return;let i=t.querySelector('input[name="tweakwiseProductId"]');if(!i)return;tweakwiseProductId=i.value}tweakwiseLayer.push({event:"addtowishlist",data:{productKey:tweakwiseProductId}})}}let s=window.PluginManager,d=s.getPluginList();try{(!1 in d||!s.getPlugin("TwAddToCartPlugin"))&&s.register("TwAddToCartPlugin",a)}catch(e){s.register("TwAddToCartPlugin",a)}try{(!1 in d||!s.getPlugin("TwAddToFavoritesPlugin"))&&s.register("TwAddToFavoritesPlugin",o)}catch(e){s.register("TwAddToFavoritesPlugin",o)}})()})();