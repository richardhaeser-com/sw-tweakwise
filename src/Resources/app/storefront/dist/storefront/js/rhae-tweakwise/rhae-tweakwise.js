(()=>{var t={621:()=>{(async()=>{let t=window.tweakwiseConfig?.instanceKey;if(!t||window.__tweakwiseEventTagLoaded||(window.__tweakwiseEventTagLoaded=!0,!window.tweakwise||"function"!=typeof window.tweakwise.getProfileKey))return;let e=await window.tweakwise.getProfileKey();!function(t,e,i,r,a,n){t._twa=i,t[i]=t[i]||[],t[i].push({"twa.start":new Date().getTime(),event:"twa.js"}),t[i].push({"twa.instance":r,event:"twa.init"}),a&&t[i].push({"twa.profile":a,event:"twa.profile"}),a&&(t[i].getProfileKey=function(){return a});var o=e.getElementsByTagName("script")[0],s=e.createElement("script");s.async=!0,s.src=n,o.parentNode.insertBefore(s,o)}(window,document,"tweakwiseLayer",t,e,"//navigator-analytics.tweakwise.com/bundles/scout.js")})()},831:()=>{(()=>{let t=window.tweakwise=window.tweakwise||{};t.getProfileKey=function(){return t.profileKey?Promise.resolve(t.profileKey):(t.profileKeyPromise||(t.profileKeyPromise=fetch("/tweakwise/profile-key",{credentials:"same-origin",headers:{Accept:"application/json"}}).then(t=>{if(!t.ok)throw Error(`Failed to load profile key (${t.status})`);return t.json()}).then(e=>(t.profileKey=e.profileKey,t.profileKey))),t.profileKeyPromise)}})()}},e={};function i(r){var a=e[r];if(void 0!==a)return a.exports;var n=e[r]={exports:{}};return t[r](n,n.exports,i),n.exports}(()=>{"use strict";i(831),i(621);class t{static iterate(t,e){if(t instanceof Map||Array.isArray(t))return t.forEach(e);if(t instanceof FormData){for(var i of t.entries())e(i[1],i[0]);return}if(t instanceof NodeList)return t.forEach(e);if(t instanceof HTMLCollection)return Array.from(t).forEach(e);if(t instanceof Object)return Object.keys(t).forEach(i=>{e(t[i],i)});throw Error(`The element type ${typeof t} is not iterable!`)}}class e{static serialize(t){let e=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if("FORM"!==t.nodeName){if(e)throw Error("The passed element is not a form!");return{}}return new FormData(t)}static serializeJson(t){let i=!(arguments.length>1)||void 0===arguments[1]||arguments[1],r=e.serialize(t,i);if(!(r instanceof FormData)&&0===Object.keys(r).length||r instanceof FormData&&0===Array.from(r.entries()).length)return{};let a={};for(let[t,e]of r.entries())a[t]=e;return a}}let r=window.PluginBaseClass;window.PluginManager;class a extends r{init(){this._registerEvents()}_registerEvents(){let t=this._addToCart.bind(this);window.addEventListener("twAddToCart",t),document.addEventListener("submit",t=>{let e=t.target.closest('form[data-add-to-cart="true"]');if(!e)return;let i=this._extractAddToCartData(e);i&&this._fireEventTag(i)},!0)}_extractShopwareUUID(t){let e=t.match(/-([a-f0-9]{32})$/i);return e?e[1]:null}_addToCart(t){let i=this._extractShopwareUUID(t.detail.data.itemno),r=t.detail.quantity||1;if(!i){console.log("Not a valid product id given",t.detail.itemno);return}let a=document.createElement("form");a.dataset.addToCart="true",a.setAttribute("action",t.detail.addToCartAction),a.setAttribute("method","post"),a.setAttribute("id","twn-add-to-cart-form"),a.setAttribute("data-add-to-cart","true");let n=document.createElement("input");n.setAttribute("type","hidden"),n.setAttribute("name","redirectTo"),n.setAttribute("value","frontend.cart.offcanvas");let o=document.createElement("input");o.setAttribute("type","hidden"),o.setAttribute("name","redirectParameters"),o.dataset.redirectParameters="true",o.setAttribute("value",'{"productId": "'+i+'"}');let s=document.createElement("input");s.setAttribute("type","hidden"),s.setAttribute("name","lineItems["+i+"][id]"),s.setAttribute("value",i);let d=document.createElement("input");d.setAttribute("type","hidden"),d.setAttribute("name","lineItems["+i+"][referencedId]"),d.setAttribute("value",i);let l=document.createElement("input");l.setAttribute("type","hidden"),l.setAttribute("name","lineItems["+i+"][type]"),l.setAttribute("value","product");let u=document.createElement("input");u.setAttribute("type","hidden"),u.setAttribute("name","lineItems["+i+"][stackable]"),u.setAttribute("value","1");let c=document.createElement("input");c.setAttribute("type","hidden"),c.setAttribute("name","lineItems["+i+"][removable]"),c.setAttribute("value","1");let w=document.createElement("input");w.setAttribute("type","hidden"),w.setAttribute("name","lineItems["+i+"][quantity]"),w.setAttribute("value",r);let p=document.createElement("input");p.setAttribute("type","hidden"),p.setAttribute("name","_csrf_token"),p.setAttribute("value",t.detail.csrfToken),a.appendChild(n),a.appendChild(o),a.appendChild(s),a.appendChild(d),a.appendChild(l),a.appendChild(u),a.appendChild(c),a.appendChild(w),a.appendChild(p);let h=t.detail.addToCartAction,m=e.serialize(a);this.$emitter.publish("beforeFormSubmit",m),this._openOffCanvasCarts(h,m)}_openOffCanvasCarts(e,i){let r=window.PluginManager.getPluginInstances("OffCanvasCart");t.iterate(r,t=>this._openOffCanvasCart(t,e,i))}_openOffCanvasCart(t,e,i){t.openOffCanvas(e,i,()=>{this.$emitter.publish("openOffCanvasCart")})}_fireEventTag(t){let{quantity:e,unitPrice:i,total:r,tweakwiseProductId:a}=t;tweakwiseLayer.push({event:"addtocart",data:{productKey:a,quantity:e,totalAmount:r}})}_extractAddToCartData(t){if("undefined"==typeof tweakwiseProductId||!tweakwiseProductId){let e=t.querySelector('input[name="tweakwiseProductId"]');if(!e)return;tweakwiseProductId=e.value}let e=t.querySelector('input[name^="lineItems["][name$="[quantity]"]'),i=1;e&&(Number.isNaN(i=parseInt(e.value||"1",10))||i<1)&&(i=1);let r=this._getUnitPriceFromDom();if(!r){let e=t.querySelector('input[name="tweakwiseProductPrice"]');r=e?e.value:0}let a=null!==r?this._roundMoney(r*i):0;return{quantity:i,unitPrice:r,total:a,tweakwiseProductId}}_getUnitPriceFromDom(){let t=document.querySelector(".product-detail-price")||document.querySelector("[data-product-price]")||document.querySelector('meta[property="product:price:amount"]');if(!t)return null;let e=t.getAttribute("data-product-price");if(e&&!Number.isNaN(parseFloat(e)))return parseFloat(e);let i=t.getAttribute("content");if(i&&!Number.isNaN(parseFloat(i)))return parseFloat(i);let r=parseFloat((t.textContent||"").trim().replace(/\s/g,"").replace(/[^\d,.-]/g,"").replace(/\.(?=\d{3}(\D|$))/g,"").replace(",","."));return Number.isFinite(r)?r:null}_roundMoney(t){return Math.round((t+Number.EPSILON)*100)/100}}let n=window.PluginBaseClass;class o extends n{init(){"WishlistStorage"in window.PluginManager.getPluginList()&&(this.classList={isLoading:"product-wishlist-loading",addedState:"product-wishlist-added",notAddedState:"product-wishlist-not-added"},this._getWishlistStorage(),this._wishlistStorage||console.warn("No wishlist storage found"),this._registerEvents())}_registerEvents(){let t=this._navigationSuccess.bind(this),e=this._addToFavorites.bind(this),i=this._fireEventTag.bind(this);document.$emitter.subscribe("Wishlist/onProductsLoaded",()=>{wishlistProductsLoaded=!0}),window.addEventListener("twAddToFavorites",e),window.addEventListener("twInitFavorites",t),document.querySelector("button[data-add-to-wishlist]")?.addEventListener("click",i)}_navigationSuccess(t){if(t.detail.data.hasOwnProperty("items"))for(var e of t.detail.data.items)this._checkProductFavorite(e);if(t.detail.data.hasOwnProperty("groups"))for(var i of t.detail.data.groups)for(var e of i.items)this._checkProductFavorite(e)}_checkProductFavorite(t){let e=this._extractShopwareUUID(t.itemno);if(!e){console.log("Not a valid product id given",t.itemno);return}this._wishlistStorage.has(e)&&document.querySelectorAll(`[data-item-id="${t.itemno}"]`).forEach(t=>{t.classList.add("in-wishlist")})}_extractShopwareUUID(t){let e=t.match(/-([a-f0-9]{32})$/i);return e?e[1]:null}_addToFavorites(t){let e=this._extractShopwareUUID(t.detail.data.itemno);if(!e){console.log("Not a valid product id given",t.event.detail.itemno);return}let i={path:t.detail.routerAddPath.replace("idPlaceholder",e),afterLoginPath:t.detail.routerAddAfterLoginPath.replace("idPlaceholder",e)},r={path:t.detail.routerRemovePath.replace("idPlaceholder",e)};var a=document.querySelectorAll(`[data-item-id="${t.detail.data.itemno}"]`);this._wishlistStorage.has(e)?(this._wishlistStorage.remove(e,r),a.forEach(t=>{t.classList.remove("in-wishlist")})):(this._wishlistStorage.add(e,i),a.forEach(t=>{t.classList.add("in-wishlist")}))}_getWishlistStorage(){let t=document.querySelector("#wishlist-basket");t&&(this._wishlistStorage=window.PluginManager.getPluginInstanceFromElement(t,"WishlistStorage"),this._wishlistStorage.load())}_fireEventTag(t){if("undefined"==typeof tweakwiseProductId||!tweakwiseProductId){let e=t.target.closest('[role="listitem"]').querySelector('form[data-add-to-cart="true"]');if(!e)return;let i=e.querySelector('input[name="tweakwiseProductId"]');if(!i)return;tweakwiseProductId=i.value}tweakwiseLayer.push({event:"addtowishlist",data:{productKey:tweakwiseProductId}})}}let s=window.PluginManager,d=s.getPluginList();try{(!1 in d||!s.getPlugin("TwAddToCartPlugin"))&&s.register("TwAddToCartPlugin",a)}catch(t){s.register("TwAddToCartPlugin",a)}try{(!1 in d||!s.getPlugin("TwAddToFavoritesPlugin"))&&s.register("TwAddToFavoritesPlugin",o)}catch(t){s.register("TwAddToFavoritesPlugin",o)}})()})();