(self.webpackChunk=self.webpackChunk||[]).push([["rhae-tweakwise"],{6095:(t,e,i)=>{"use strict";i(7792),i(8439);var a=i(6285),r=(i(9068),i(1966)),n=i(836);class o extends a.Z{init(){this._registerEvents()}_registerEvents(){const t=this._addToCart.bind(this);window.addEventListener("twAddToCart",t),document.addEventListener("submit",(t=>{const e=t.target.closest('form[data-add-to-cart="true"]');if(!e)return;const i=this._extractAddToCartData(e);i&&this._fireEventTag(i)}),!0)}_extractShopwareUUID(t){const e=t.match(/-([a-f0-9]{32})$/i);return e?e[1]:null}_addToCart(t){const e=this._extractShopwareUUID(t.detail.data.itemno),i=t.detail.quantity||1;if(!e)return void console.log("Not a valid product id given",t.detail.itemno);let a=document.createElement("form");a.dataset.addToCart="true",a.setAttribute("action",t.detail.addToCartAction),a.setAttribute("method","post"),a.setAttribute("id","twn-add-to-cart-form"),a.setAttribute("data-add-to-cart","true");let r=document.createElement("input");r.setAttribute("type","hidden"),r.setAttribute("name","redirectTo"),r.setAttribute("value","frontend.cart.offcanvas");let o=document.createElement("input");o.setAttribute("type","hidden"),o.setAttribute("name","redirectParameters"),o.dataset.redirectParameters="true",o.setAttribute("value",'{"productId": "'+e+'"}');let s=document.createElement("input");s.setAttribute("type","hidden"),s.setAttribute("name","lineItems["+e+"][id]"),s.setAttribute("value",e);let d=document.createElement("input");d.setAttribute("type","hidden"),d.setAttribute("name","lineItems["+e+"][referencedId]"),d.setAttribute("value",e);let u=document.createElement("input");u.setAttribute("type","hidden"),u.setAttribute("name","lineItems["+e+"][type]"),u.setAttribute("value","product");let l=document.createElement("input");l.setAttribute("type","hidden"),l.setAttribute("name","lineItems["+e+"][stackable]"),l.setAttribute("value","1");let c=document.createElement("input");c.setAttribute("type","hidden"),c.setAttribute("name","lineItems["+e+"][removable]"),c.setAttribute("value","1");let w=document.createElement("input");w.setAttribute("type","hidden"),w.setAttribute("name","lineItems["+e+"][quantity]"),w.setAttribute("value",i);let p=document.createElement("input");p.setAttribute("type","hidden"),p.setAttribute("name","_csrf_token"),p.setAttribute("value",t.detail.csrfToken),a.appendChild(r),a.appendChild(o),a.appendChild(s),a.appendChild(d),a.appendChild(u),a.appendChild(l),a.appendChild(c),a.appendChild(w),a.appendChild(p);const h=t.detail.addToCartAction,m=n.Z.serialize(a);this.$emitter.publish("beforeFormSubmit",m),this._openOffCanvasCarts(h,m)}_openOffCanvasCarts(t,e){const i=window.PluginManager.getPluginInstances("OffCanvasCart");r.Z.iterate(i,(i=>this._openOffCanvasCart(i,t,e)))}_openOffCanvasCart(t,e,i){t.openOffCanvas(e,i,(()=>{this.$emitter.publish("openOffCanvasCart")}))}_fireEventTag({quantity:t,unitPrice:e,total:i,tweakwiseProductId:a}){tweakwiseLayer.push({event:"addtocart",data:{productKey:a,quantity:t,totalAmount:i}})}_extractAddToCartData(t){if("undefined"==typeof tweakwiseProductId||!tweakwiseProductId){const e=t.querySelector('input[name="tweakwiseProductId"]');if(!e)return;tweakwiseProductId=e.value}const e=t.querySelector('input[name^="lineItems["][name$="[quantity]"]');let i=1;e&&(i=parseInt(e.value||"1",10),(Number.isNaN(i)||i<1)&&(i=1));let a=this._getUnitPriceFromDom();if(!a){const e=t.querySelector('input[name="tweakwiseProductPrice"]');a=e?e.value:0}return{quantity:i,unitPrice:a,total:null!==a?this._roundMoney(a*i):0,tweakwiseProductId:tweakwiseProductId}}_getUnitPriceFromDom(){const t=document.querySelector(".product-detail-price")||document.querySelector("[data-product-price]")||document.querySelector('meta[property="product:price:amount"]');if(!t)return null;const e=t.getAttribute("data-product-price");if(e&&!Number.isNaN(parseFloat(e)))return parseFloat(e);const i=t.getAttribute("content");if(i&&!Number.isNaN(parseFloat(i)))return parseFloat(i);const a=(t.textContent||"").trim().replace(/\s/g,"").replace(/[^\d,.-]/g,"").replace(/\.(?=\d{3}(\D|$))/g,"").replace(",","."),r=parseFloat(a);return Number.isFinite(r)?r:null}_roundMoney(t){return Math.round(100*(t+Number.EPSILON))/100}}var s=i(3206);class d extends a.Z{init(){"WishlistStorage"in window.PluginManager.getPluginList()&&(this.classList={isLoading:"product-wishlist-loading",addedState:"product-wishlist-added",notAddedState:"product-wishlist-not-added"},this._getWishlistStorage(),this._wishlistStorage||console.warn("No wishlist storage found"),this._registerEvents())}_registerEvents(){var t;const e=this._navigationSuccess.bind(this),i=this._addToFavorites.bind(this),a=this._fireEventTag.bind(this);document.$emitter.subscribe("Wishlist/onProductsLoaded",(()=>{wishlistProductsLoaded=!0})),window.addEventListener("twAddToFavorites",i),window.addEventListener("twInitFavorites",e),null===(t=document.querySelector("button[data-add-to-wishlist]"))||void 0===t||t.addEventListener("click",a)}_navigationSuccess(t){if(t.detail.data.hasOwnProperty("items")){var e=t.detail.data.items;for(var i of e)this._checkProductFavorite(i)}if(t.detail.data.hasOwnProperty("groups"))for(var a of t.detail.data.groups)for(var i of a.items)this._checkProductFavorite(i)}_checkProductFavorite(t){const e=this._extractShopwareUUID(t.itemno);e?this._wishlistStorage.has(e)&&document.querySelectorAll(`[data-item-id="${t.itemno}"]`).forEach((t=>{t.classList.add("in-wishlist")})):console.log("Not a valid product id given",t.itemno)}_extractShopwareUUID(t){const e=t.match(/-([a-f0-9]{32})$/i);return e?e[1]:null}_addToFavorites(t){const e=this._extractShopwareUUID(t.detail.data.itemno);if(!e)return void console.log("Not a valid product id given",t.event.detail.itemno);const i={path:t.detail.routerAddPath.replace("idPlaceholder",e),afterLoginPath:t.detail.routerAddAfterLoginPath.replace("idPlaceholder",e)},a={path:t.detail.routerRemovePath.replace("idPlaceholder",e)};var r=document.querySelectorAll(`[data-item-id="${t.detail.data.itemno}"]`);this._wishlistStorage.has(e)?(this._wishlistStorage.remove(e,a),r.forEach((t=>{t.classList.remove("in-wishlist")}))):(this._wishlistStorage.add(e,i),r.forEach((t=>{t.classList.add("in-wishlist")})))}_getWishlistStorage(){const t=s.Z.querySelector(document,"#wishlist-basket",!1);t&&(this._wishlistStorage=window.PluginManager.getPluginInstanceFromElement(t,"WishlistStorage"),this._wishlistStorage.load())}_fireEventTag(t){if("undefined"==typeof tweakwiseProductId||!tweakwiseProductId){const e=t.target.closest('[role="listitem"]').querySelector('form[data-add-to-cart="true"]');if(!e)return;const i=e.querySelector('input[name="tweakwiseProductId"]');if(!i)return;tweakwiseProductId=i.value}tweakwiseLayer.push({event:"addtowishlist",data:{productKey:tweakwiseProductId}})}}const u=window.PluginManager;try{u.getPlugin("TwAddToCartPlugin")||u.register("TwAddToCartPlugin",o)}catch(t){u.register("TwAddToCartPlugin",o)}try{u.getPlugin("TwAddToFavoritesPlugin")||u.register("TwAddToFavoritesPlugin",d)}catch(t){u.register("TwAddToFavoritesPlugin",d)}},8439:()=>{(async()=>{var t;const e=null===(t=window.tweakwiseConfig)||void 0===t?void 0:t.instanceKey;if(!e)return;if(window.__tweakwiseEventTagLoaded)return;if(window.__tweakwiseEventTagLoaded=!0,!window.tweakwise||"function"!=typeof window.tweakwise.getProfileKey)return;const i=await window.tweakwise.getProfileKey();!function(t,e,i,a,r,n){t._twa=i,t[i]=t[i]||[],t[i].push({"twa.start":(new Date).getTime(),event:"twa.js"}),t[i].push({"twa.instance":a,event:"twa.init"}),r&&t[i].push({"twa.profile":r,event:"twa.profile"}),r&&(t[i].getProfileKey=function(){return r});var o=e.getElementsByTagName("script")[0],s=e.createElement("script");s.async=!0,s.src=n,o.parentNode.insertBefore(s,o)}(window,document,"tweakwiseLayer",e,i,"//navigator-analytics.tweakwise.com/bundles/scout.js")})()},7792:()=>{(()=>{const t=window.tweakwise=window.tweakwise||{};t.getProfileKey=function(){return t.profileKey?Promise.resolve(t.profileKey):(t.profileKeyPromise||(t.profileKeyPromise=fetch("/tweakwise/profile-key",{credentials:"same-origin",headers:{Accept:"application/json"}}).then((t=>{if(!t.ok)throw new Error(`Failed to load profile key (${t.status})`);return t.json()})).then((e=>(t.profileKey=e.profileKey,t.profileKey)))),t.profileKeyPromise)}})()}},t=>{t.O(0,["vendor-node","vendor-shared"],(()=>{return e=6095,t(t.s=e);var e}));t.O()}]);